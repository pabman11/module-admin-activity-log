<?php

/**
 * KiwiCommerce
 *
 * Do not edit or add to this file if you wish to upgrade to newer versions in the future.
 * If you wish to customize this module for your needs.
 * Please contact us https://kiwicommerce.co.uk/contacts.
 *
 * @category   KiwiCommerce
 * @package    MageOS_AdminActivityLog
 * @copyright  Copyright (C) 2018 Kiwi Commerce Ltd (https://kiwicommerce.co.uk/)
 * @license    https://kiwicommerce.co.uk/magento2-extension-license/
 */

/** @var Escaper $escaper */
/** @var ActivityLogListing $block */

use Magento\Framework\Escaper;
use MageOS\AdminActivityLog\Block\Adminhtml\ActivityLogListing;

$collection = $block->getLogListing();
$adminDetails = $block->getAdminDetails();
?>
<table border="0" width="100%" cellspacing="0" cellpadding="0">
    <tr>
        <td>
            <table border="0" width="100%" cellspacing="1" cellpadding="1">
                <tr style="height: 35px;text-indent: 10px;">
                    <td width="10%" style="font-size: 16px;font-weight: 600;">Admin</td>
                    <td width="1%" style="font-size: 16px;font-weight: 600;">:</td>
                    <td><?php
                        if (!empty($adminDetails['username'])) {
                            echo $escaper->escapeHtml($adminDetails['username']);
                            if (!empty($adminDetails['name'])) {
                                echo $escaper->escapeHtml(" (" . ucwords(strtolower($adminDetails['name'])) . ") ");
                            }
                        }
                        ?></td>
                </tr>
                <tr style="height: 35px;text-indent: 10px;">
                    <td style="font-size: 16px;font-weight: 600;">Module</td>
                    <td width="1%" style="font-size: 16px;font-weight: 600;">:</td>
                    <td><?= $escaper->escapeHtml($adminDetails['module']) ?></td>
                </tr>
                <tr style="height: 35px;text-indent: 10px;">
                    <td style="font-size: 16px;font-weight: 600;">Action</td>
                    <td width="1%" style="font-size: 16px;font-weight: 600;">:</td>
                    <td><?= $escaper->escapeHtml($adminDetails['fullaction']) ?> </td>
                </tr>
                <tr style="height: 35px;text-indent: 10px;">
                    <td style="font-size: 16px;font-weight: 600;">Scope</td>
                    <td width="1%" style="font-size: 16px;font-weight: 600;">:</td>
                    <td><?= $escaper->escapeHtml($adminDetails['scope']) ?> </td>
                </tr>
                <tr style="height: 35px;text-indent: 10px;">
                    <td style="font-size: 16px;font-weight: 600;">Store</td>
                    <td width="1%" style="font-size: 16px;font-weight: 600;">:</td>
                    <td><?= $escaper->escapeHtml($adminDetails['store_name']) ?> </td>
                </tr>
                <tr style="height: 35px;text-indent: 10px;">
                    <td style="font-size: 16px;font-weight: 600;">Path</td>
                    <td width="1%" style="font-size: 16px;font-weight: 600;">:</td>
                    <td><?= $escaper->escapeHtml($adminDetails['path']) ?> </td>
                </tr>
                <tr style="height: 35px;text-indent: 10px;">
                    <td style="font-size: 16px;font-weight: 600;">User Agent</td>
                    <td width="1%" style="font-size: 16px;font-weight: 600;">:</td>
                    <td style="text-indent: 0;padding-left: 10px;"><?= $escaper->escapeHtml(
                            $adminDetails['browser'],
                            ['strong', 'br']
                        ) ?></td>
                </tr>
                <tr style="height: 35px;text-indent: 10px;">
                    <td style="font-size: 16px;font-weight: 600;">Date</td>
                    <td width="1%" style="font-size: 16px;font-weight: 600;">:</td>
                    <td><?= $escaper->escapeHtml($adminDetails['date']) ?></td>
                </tr>
            </table>
        </td>
    </tr>
    <tr>
        <td style="height:  35px;"></td>
    </tr>
    <?php
    if (!empty($collection)): ?>
        <tr>
            <td>
                <table border="1" width="100%" cellspacing="1" cellpadding="1">
                    <tr style="font-size: 16px;height: 50px;">
                        <th width="20%">Field Name</th>
                        <th width="40%">Old Value</th>
                        <th width="40%">New Value</th>
                    </tr>
                    <?php
                    foreach ($collection as $item): ?>
                        <tr style="height:45px; text-indent:10px;">
                            <td>
                                <?= $escaper->escapeHtml(ucfirst(str_replace('_', ' ', $item["field_name"]))) ?>
                            </td>
                            <td>
                                <textarea class="value-container" readonly><?php
                                    if (!$block->getActivityRepository()->isFieldProtected($item['field_name'])):
                                        echo $escaper->escapeHtml($item['old_value']);
                                    endif ?></textarea>
                            </td>
                            <td>
                                <textarea class="value-container" readonly><?php
                                    if (!$block->getActivityRepository()->isFieldProtected($item['field_name'])):
                                        echo $escaper->escapeHtml($item['new_value']);
                                    endif ?></textarea>
                            </td>
                        </tr>
                    <?php
                    endforeach; ?>
                </table>
            </td>
        </tr>
    <?php
    endif; ?>
</table>
